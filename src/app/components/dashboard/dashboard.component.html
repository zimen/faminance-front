<div class="dashboard-container">
  <div class="header">
    <h1>Tableau de Bord Financier</h1>
    <div class="month-selector">
      <button (click)="previousMonth()" class="btn-nav">←</button>
      <h2>{{ monthName }} {{ currentYear }}</h2>
      <button (click)="nextMonth()" class="btn-nav">→</button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Chargement...</div>

  <div *ngIf="!loading && statistics" class="content">
    <!-- Résumé financier -->
    <div class="summary-cards">
      <div class="card income-card">
        <h3>Revenus</h3>
        <p class="amount">{{ statistics.totalIncome | number:'1.2-2' }} €</p>
      </div>
      <div class="card expense-card">
        <h3>Dépenses</h3>
        <p class="amount">{{ statistics.totalExpense | number:'1.2-2' }} €</p>
      </div>
      <div class="card balance-card" [class.negative]="statistics.balance < 0">
        <h3>Solde</h3>
        <p class="amount">{{ statistics.balance | number:'1.2-2' }} €</p>
      </div>
    </div>

    <!-- Statistiques par catégorie -->
    <div class="statistics-section">
      <div class="category-stats">
        <h3>Dépenses par Catégorie</h3>
        <div *ngFor="let cat of statistics.expenseByCategory" class="category-item">
          <div class="category-info">
            <span class="icon" [style.color]="cat.categoryColor">{{ cat.categoryIcon }}</span>
            <span class="name">{{ cat.categoryName }}</span>
            <span class="amount">{{ cat.amount | number:'1.2-2' }} €</span>
            <span class="percentage">({{ cat.percentage | number:'1.1-1' }}%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress" [style.width.%]="cat.percentage" [style.background-color]="cat.categoryColor"></div>
          </div>
        </div>
      </div>

      <div class="category-stats">
        <h3>Revenus par Catégorie</h3>
        <div *ngFor="let cat of statistics.incomeByCategory" class="category-item">
          <div class="category-info">
            <span class="icon" [style.color]="cat.categoryColor">{{ cat.categoryIcon }}</span>
            <span class="name">{{ cat.categoryName }}</span>
            <span class="amount">{{ cat.amount | number:'1.2-2' }} €</span>
            <span class="percentage">({{ cat.percentage | number:'1.1-1' }}%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress" [style.width.%]="cat.percentage" [style.background-color]="cat.categoryColor"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Budgets -->
    <div class="budgets-section" *ngIf="budgets.length > 0">
      <h3>Suivi des Budgets</h3>
      <div class="budget-list">
        <div *ngFor="let budget of budgets" class="budget-item" [class]="getBudgetStatus(budget)">
          <div class="budget-header">
            <span class="category-name">{{ budget.category?.name }}</span>
            <span class="budget-amounts">
              {{ budget.actualAmount | number:'1.2-2' }} / {{ budget.plannedAmount | number:'1.2-2' }} €
            </span>
          </div>
          <div class="progress-bar">
            <div class="progress" [style.width.%]="budget.completionPercentage"></div>
          </div>
          <div class="budget-footer">
            <span>{{ budget.completionPercentage | number:'1.0-0' }}%</span>
            <span [class.remaining-positive]="(budget.remainingAmount || 0) >= 0"
                  [class.remaining-negative]="(budget.remainingAmount || 0) < 0">
              Reste: {{ budget.remainingAmount | number:'1.2-2' }} €
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions rapides -->
    <div class="quick-actions">
      <a routerLink="/transactions" class="action-btn">Voir les Transactions</a>
      <a routerLink="/budgets" class="action-btn">Gérer les Budgets</a>
      <a routerLink="/categories" class="action-btn">Gérer les Catégories</a>
    </div>
  </div>
</div>
